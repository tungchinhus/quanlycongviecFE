<div class="change-password-dialog">
  <h2 mat-dialog-title>Đổi mật khẩu</h2>
  
  <mat-dialog-content>
    <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()">
      @if (errorMessage) {
        <div class="error-message">{{ errorMessage }}</div>
      }

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Mật khẩu hiện tại</mat-label>
        <input matInput 
               [type]="hideCurrentPassword ? 'password' : 'text'" 
               formControlName="currentPassword" 
               placeholder="Nhập mật khẩu hiện tại">
        <button mat-icon-button matSuffix 
                (click)="hideCurrentPassword = !hideCurrentPassword" 
                type="button">
          <mat-icon>{{hideCurrentPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        @if (getErrorMessage('currentPassword')) {
          <mat-error>{{ getErrorMessage('currentPassword') }}</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Mật khẩu mới</mat-label>
        <input matInput 
               [type]="hideNewPassword ? 'password' : 'text'" 
               formControlName="newPassword" 
               placeholder="Nhập mật khẩu mới (tối thiểu 6 ký tự)">
        <button mat-icon-button matSuffix 
                (click)="hideNewPassword = !hideNewPassword" 
                type="button">
          <mat-icon>{{hideNewPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        @if (getErrorMessage('newPassword')) {
          <mat-error>{{ getErrorMessage('newPassword') }}</mat-error>
        }
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Xác nhận mật khẩu mới</mat-label>
        <input matInput 
               [type]="hideConfirmPassword ? 'password' : 'text'" 
               formControlName="confirmPassword" 
               placeholder="Nhập lại mật khẩu mới">
        <button mat-icon-button matSuffix 
                (click)="hideConfirmPassword = !hideConfirmPassword" 
                type="button">
          <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        @if (getErrorMessage('confirmPassword')) {
          <mat-error>{{ getErrorMessage('confirmPassword') }}</mat-error>
        }
      </mat-form-field>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()" [disabled]="isLoading">
      Hủy
    </button>
    <button mat-raised-button 
            color="primary" 
            (click)="onSubmit()" 
            [disabled]="changePasswordForm.invalid || isLoading">
      @if (isLoading) {
        <mat-icon class="spinning">refresh</mat-icon>
      } @else {
        <mat-icon>lock</mat-icon>
      }
      @if (isLoading) {
        Đang xử lý...
      } @else {
        Đổi mật khẩu
      }
    </button>
  </mat-dialog-actions>
</div>

