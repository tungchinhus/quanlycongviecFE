<mat-card class="role-management-card">
  <mat-card-header>
    <mat-card-title>
      <mat-icon>admin_panel_settings</mat-icon>
      Gán quyền cho người dùng
    </mat-card-title>
    <mat-card-subtitle>{{ user().name }} ({{ user().email }})</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    @if (isUpdating) {
      <div class="updating-overlay">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Đang cập nhật quyền...</p>
      </div>
    }

    <div class="roles-list">
      @for (role of allRoles; track role) {
        <div class="role-item" [class.disabled]="!isAdmin() || isUpdating">
          <div class="role-info">
            <mat-icon class="role-icon">{{ getRoleIcon(role) }}</mat-icon>
            <div class="role-details">
              <div class="role-name">{{ role }}</div>
              <div class="role-description">{{ getRoleDescription(role) }}</div>
            </div>
          </div>
          <mat-checkbox
            [checked]="hasRole(role)"
            [disabled]="!isAdmin() || isUpdating || (currentUserId() === user().id && role === administratorRole && hasRole(role))"
            (change)="onToggleRole(role, $event.checked)"
            color="primary">
          </mat-checkbox>
        </div>
      }
    </div>

    @if (!isAdmin()) {
      <div class="warning-message">
        <mat-icon>info</mat-icon>
        <span>Chỉ Administrator mới có thể thay đổi quyền người dùng.</span>
      </div>
    }
  </mat-card-content>
</mat-card>

