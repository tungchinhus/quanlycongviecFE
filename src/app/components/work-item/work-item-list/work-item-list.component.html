<mat-card>
  <mat-card-header>
    <mat-card-title>Danh Sách Công Việc</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Đang tải danh sách công việc...</p>
    </div>

    <table *ngIf="!isLoading" mat-table [dataSource]="workItems" class="work-item-table">
      <ng-container matColumnDef="machineName">
        <th mat-header-cell *matHeaderCellDef>Tên máy</th>
        <td mat-cell *matCellDef="let item">
          <div class="assignment-info">
            <div class="machine-name">{{ getMachineName(item) }}</div>
            <div class="tbkt-id" *ngIf="item.assignment?.tbkt_ID">
              <small>{{ item.assignment.tbkt_ID }}</small>
            </div>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="startDate">
        <th mat-header-cell *matHeaderCellDef>Ngày Bắt Đầu</th>
        <td mat-cell *matCellDef="let item">
          {{ item.startDate ? (item.startDate | date:'dd/MM/yyyy') : '-' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="expectedFinish">
        <th mat-header-cell *matHeaderCellDef>Dự Kiến Hoàn Thành</th>
        <td mat-cell *matCellDef="let item">
          {{ item.expectedFinish ? (item.expectedFinish | date:'dd/MM/yyyy') : '-' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="actualFinish">
        <th mat-header-cell *matHeaderCellDef>Hoàn Thành Thực Tế</th>
        <td mat-cell *matCellDef="let item">
          <span *ngIf="item.actualFinish; else notFinished">
            {{ item.actualFinish | date:'dd/MM/yyyy' }}
          </span>
          <ng-template #notFinished>
            <mat-chip color="warn">Chưa hoàn thành</mat-chip>
          </ng-template>
        </td>
      </ng-container>

      <ng-container matColumnDef="personConfirmation">
        <th mat-header-cell *matHeaderCellDef>Xác Nhận</th>
        <td mat-cell *matCellDef="let item">
          <mat-chip [color]="item.personConfirmation ? 'primary' : 'warn'">
            {{ item.personConfirmation ? 'Đã xác nhận' : 'Chưa xác nhận' }}
          </mat-chip>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Thao tác</th>
        <td mat-cell *matCellDef="let item">
          <button mat-icon-button [matMenuTriggerFor]="menu" [matTooltip]="'Tùy chọn'">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="viewWorkItem(item)">
              <mat-icon>visibility</mat-icon>
              <span>Xem</span>
            </button>
            <button mat-menu-item (click)="editWorkItem(item)">
              <mat-icon>edit</mat-icon>
              <span>Chỉnh sửa</span>
            </button>
            <mat-divider></mat-divider>
            <button mat-menu-item (click)="deleteWorkItem(item)" class="delete-action">
              <mat-icon>delete</mat-icon>
              <span>Xóa</span>
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <div *ngIf="!isLoading && workItems.length === 0" class="no-data">
      <mat-icon>work</mat-icon>
      <p>Bạn chưa có công việc nào</p>
    </div>
  </mat-card-content>
</mat-card>



