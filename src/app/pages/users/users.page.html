<h2>Quản lý người dùng</h2>

@if (errorMessage) {
  <div class="error-message">{{ errorMessage }}</div>
}

<table class="table">
  <thead>
    <tr>
      <th>Tên</th>
      <th>Email</th>
      <th>Firebase UID</th>
      <th>Roles</th>
      <th>Thao tác</th>
    </tr>
  </thead>
  <tbody>
    @if (users().length === 0) {
      <tr>
        <td colspan="5" style="text-align: center; padding: 20px;">
          Chưa có người dùng nào. Hãy tạo người dùng mới.
        </td>
      </tr>
    } @else {
      <tr *ngFor="let u of users()">
        <td>{{ u.name }}</td>
        <td>{{ u.email }}</td>
        <td><small style="color: #666;">{{ u.firebaseUid || 'N/A' }}</small></td>
        <td>
          <label *ngFor="let r of allRoles" style="margin-right:12px; display:inline-flex; align-items:center;">
            <input type="checkbox" [checked]="u.roles.includes(r)" (change)="onToggleRole(u.id, r, $any($event.target).checked)" />
            <span style="margin-left:6px">{{ r }}</span>
          </label>
        </td>
        <td>
          <button (click)="remove(u.id)" class="btn-danger">Xoá</button>
        </td>
      </tr>
    }
  </tbody>
</table>

<div class="add-user-section">
  <h3>Thêm người dùng mới</h3>
  <p class="info-text">Tạo user trên Firebase Authentication, sau đó tạo trong Database local.</p>
  
  <form (ngSubmit)="add()" class="add-user-form">
    <div class="form-group">
      <label>Họ tên *</label>
      <input [(ngModel)]="newName" name="name" required [disabled]="isCreating" />
    </div>
    <div class="form-group">
      <label>Email *</label>
      <input type="email" [(ngModel)]="newEmail" name="email" required [disabled]="isCreating" />
    </div>
    <div class="form-group">
      <label>Mật khẩu * (tối thiểu 6 ký tự)</label>
      <input type="password" [(ngModel)]="newPassword" name="password" required minlength="6" [disabled]="isCreating" />
    </div>
    <div class="form-group">
      <label>Quyền mặc định</label>
      <select [(ngModel)]="newRole" name="role" [disabled]="isCreating">
        <option *ngFor="let r of allRoles" [value]="r">{{ r }}</option>
      </select>
    </div>
    <button type="submit" [disabled]="isCreating || !newName || !newEmail || !newPassword || newPassword.length < 6">
      @if (isCreating) {
        <span>Đang tạo...</span>
      } @else {
        <span>Thêm người dùng</span>
      }
    </button>
  </form>
</div>

